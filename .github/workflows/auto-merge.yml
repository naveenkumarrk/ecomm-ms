name: Auto Merge PR

on:
	workflow_run:
		workflows: ["CI Feature"]
		types:
			- completed

jobs:
	auto-merge:
		runs-on: ubuntu-latest
		if: |
			github.event.workflow_run.conclusion == 'success' &&
			github.event.workflow_run.event == 'pull_request' &&
			github.event.workflow_run.pull_requests[0].head.ref != 'main'
		permissions:
			contents: write
			pull-requests: write
		steps:
			- name: Auto-merge PR
				uses: pascalgn/automerge-action@v0.16.4
				env:
					GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
					MERGE_METHOD: squash
					MERGE_LABELS: ""
					MERGE_COMMIT_MESSAGE: "Auto-merge: ${{ github.event.workflow_run.pull_requests[0].title }}"
					MERGE_DELETE_BRANCH: true

